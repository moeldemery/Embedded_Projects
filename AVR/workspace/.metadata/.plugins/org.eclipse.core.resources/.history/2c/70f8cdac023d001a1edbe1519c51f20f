/*
 * APP_Calc.c
 *
 *  Created on: 22 Jan 2020
 *      Author: Mohamed
 */

#include "APP_Calc.h"

void APP_STR_CPY(u8*arr , u8*copy_value ,u16 size)
{
	int i;
	for (i = 0; i < size; ++i)
	{
		arr[i]=copy_value[i];
	}
}
void APP_CALC_atoi(void)
{

}

u8 lcd_display_1[16]= {0};
u8 lcd_display_2[16]= {0};
u8 curser=0;
u8 update_screen=0;
u8 first_number;
u8 first_number_flag=0;
u8 second_number;
u8 second_number_flag=0;
u8 operation;
u8 operation_selected=0;
u8 result=0;

void APP_CALCUTATOR(void)
{
	while(1)
	{

		if(update_screen)
		{
			LCD_Clear();
			LCD_void_SendString(lcd_display_1);
			LCD_GoTO(1,2);
			LCD_void_SendString(lcd_display_2);
			LCD_GoTO(curser+1,1);
			update_screen=0;
		}
		int i;
		u8 operation;
		u8 operation_selected;
		for(i=0;i<curser;i++)
		{
			if(lcd_display_1[i]>='0' && lcd_display_1[i]<='9')
			{
				if(first_number_flag==0)
				{
					first_number=lcd_display_1[i];
					first_number_flag=1;

				}
				else if(operation_selected==1)
				{
					second_number=lcd_display_1[i];
					second_number_flag=1;
				}
				else if(second_number_flag==1)
				{

				}

			}
			else
			{
				APP_operation();
			}
		}

	}
}

void APP_operation(void)
{
	switch (lcd_display_1[i])
	{
		case'C':
		{

			 curser=0;
			 update_screen=0;
			 first_number=0;
			 first_number_flag=0;
			 second_number=0;
			 second_number_flag=0;
			 operation=0;
			 operation_selected=0;
			 result=0;
			u8 j=0;
			for(j=0;j<16;j++)
			{
				lcd_display_1[j]=0;
				lcd_display_2[j]=0;
			}

			LCD_Clear();
			LCD_GoTO(1,1);
			break;
		}
		case '=':
		{
			if(first_number_flag==1 && operation_selected ==1  && second_number_flag ==1)
			{
				switch (operation)
				{
					case 1:
					{
						result=(first_number-'0')+(second_number-'0');
						lcd_display_2[0]=result+'0';
						lcd_display_2[15]='\0';
						update_screen=1;
						operation=0;
						operation_selected=0;
						break;
					}

					default:
						break;
				}
			}


			break;
		}
		case '+':
		{
			operation=1;
			first_number_flag=1;
			operation_selected=1;
			break;
		}

		default:
		{
			APP_STR_CPY(lcd_display_2,"error",16);
			//update_screen=1;
			break;
		}

	}
}

void APP_KPD(u8 kpd_reaading[], u8 index)
{
	u8 key,lastKey;
	key = KPD_Scan();
	lastKey = key;
	key = KPD_Scan();
	if(key != lastKey && key!=0)
	{
		kpd_reaading[index]=key;
		key=0;
		curser++;
		update_screen=1;
	}
}
