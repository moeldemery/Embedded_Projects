/*
 * SPI.c
 *
 *  Created on: 27 Jan 2020
 *      Author: Mohamed
 */

#include "SPI.h"

SPI_config_t SPI_group = {	SPI_EN , SPI_SLAVE	,SPI_MSB_FIRST,SPI_LEADING_EDGE_RISING,SPI_LEADING_EDGE_SAMPLING,SPI_F_4,SPI_INT_DISABLE};

void SPI_Init(void)
{
	u8	SPCR_temp=0;
	u8  SPSR_temp=0;
	switch (SPI_group.SPI_Enable)
	{
		case SPI_EN:
		{
			SET_BIT(SPCR_temp,SPE);
			break;
		}
		case SPI_DISABLE:
		{
			CLR_BIT(SPCR_temp,SPE);
			break;
		}
		default:
		{
			//#warning "unexpected input in UART Enable type"
			break;
		}
	}
	//********************************************************
	switch (SPI_group.SPI_M_S)
	{
		case SPI_MASTER :
		{
			SET_BIT(SPCR_temp,MSTR);
			break;
		}
		case SPI_SLAVE :
		{
			CLR_BIT(SPCR_temp,MSTR);
			break;
		}
		default:
		{
			//#warning "unexpected input in UART Enable type"
			break;
		}
	}
	//********************************************************
	switch (SPI_group.SPI_Data_Order)
	{
		case SPI_LSB_FIRST  :
		{
			SET_BIT(SPCR_temp,DORD);
			break;
		}
		case  SPI_MSB_FIRST :
		{
			CLR_BIT(SPCR_temp,DORD);
			break;
		}
		default:
		{
			//#warning "unexpected input in UART Enable type"
			break;
		}
	}
	//********************************************************

	switch (SPI_group.SPI_Clk_Polarity)
	{
		case SPI_LEADING_EDGE_RISING  :
		{
			CLR_BIT(SPCR_temp,CPOL);
			break;
		}
		case  SPI_LEADING_EDGE_FALLING :
		{
			SET_BIT(SPCR_temp,CPOL);
			break;
		}
		default:
		{
			//#warning "unexpected input in UART Enable type"
			break;
		}
	}
	//*******************************************************
	switch (SPI_group.SPI_Clk_Phase)
	{
		case SPI_LEADING_EDGE_SAMPLING  :
		{
			CLR_BIT(SPCR_temp,CPHA);
			break;
		}
		case  SPI_LEADING_EDGE_SETUP :
		{
			SET_BIT(SPCR_temp,CPHA);
			break;
		}
		default:
		{
			//#warning "unexpected input in UART Enable type"
			break;
		}
	}
	//********************************************************

	switch (SPI_group.SPI_Clk_Rate)
	{
		case SPI_F_2 :
		{
			CLR_BIT(SPCR_temp,SPR0);
			CLR_BIT(SPCR_temp,SPR1);
			SET_BIT(SPSR_temp,SPI2X);
			break;
		}
		case SPI_F_4 :
		{
			CLR_BIT(SPCR_temp,SPR0);
			CLR_BIT(SPCR_temp,SPR1);
			CLR_BIT(SPSR_temp,SPI2X);
			break;
		}
		case SPI_F_8 :
		{
			SET_BIT(SPCR_temp,SPR0);
			CLR_BIT(SPCR_temp,SPR1);
			SET_BIT(SPSR_temp,SPI2X);
			break;
		}
		case SPI_F_16 :
		{
			SET_BIT(SPCR_temp,SPR0);
			CLR_BIT(SPCR_temp,SPR1);
			CLR_BIT(SPSR_temp,SPI2X);
			break;
		}
		case SPI_F_32 :
		{
			CLR_BIT(SPCR_temp,SPR0);
			SET_BIT(SPCR_temp,SPR1);
			SET_BIT(SPSR_temp,SPI2X);
			break;
		}
		case SPI_F_64 :
		{
			CLR_BIT(SPCR_temp,SPR0);
			SET_BIT(SPCR_temp,SPR1);
			CLR_BIT(SPSR_temp,SPI2X);
			break;
		}
		case SPI_F_128 :
		{
			SET_BIT(SPCR_temp,SPR0);
			SET_BIT(SPCR_temp,SPR1);
			CLR_BIT(SPSR_temp,SPI2X);
			break;
		}

		default:
		{
			//#warning "unexpected input in UART Enable type"
			break;
		}
	}
	//********************************************************

	SPCR=SPCR_temp;
	SPSR=SPSR_temp;
}




u8 SPI_TXRX (u8 Copy_tx_data)
{

	//copy data to data register
	SPDR = Copy_tx_data;
	//wait transfer to complete
	while(  GET_BIT(SPSR,SPIF) ==0 );
	//save received data

     return SPDR;


}
