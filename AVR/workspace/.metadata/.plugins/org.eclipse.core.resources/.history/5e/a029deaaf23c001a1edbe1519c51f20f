/*
 * main.c
 *
 *  Created on: 31 Dec 2019
 *      Author: Mohamed
 */



#include "UTILITIES/STD_TYPES.h"
#include "UTILITIES/BIT_MATH.h"

#include "MCAL/INC/DIO_driver.h"
#include "MCAL/INC/UART_driver.h"
#include "MCAL/INC/INT_interface.h"
#include "MCAL/INC/TMR.h"

#include "HAL/INC/LED.h"
#include "HAL/INC/BTN.h"
#include "HAL/INC/LCD_driver.h"
#include "HAL/INC/KPD.h"
#include "HAL/INC/SVNSEG.h"

#include "APP/APP_UnitTesting.h"

#include <util/delay.h>




int main(void)
{
	DIO_Init();
	LCD_void_Init();
	//INT_Void_ExternalIntInit(EXT_INT_0);

	//APP_UART_LCD();
	//APP_UART_virtual();
	//APP_BTN_Toggle_LED();
	//APP_Counter_2SvnSeg_2Btn_3Led();

	//APP_LCD_shifting_2BTN();

	//APP_TMR0_polling_CTC_cmpmatch_toggle_LED1();





	u8 lcd_display_1[16]= {0};
	u8 lcd_display_2[16]= {0};
	u8 curser=0;
	u8 update_screen=0;
	u8 first_number;
	u8 first_number_flag=0;
	u8 second_number;
	u8 second_number_flag=0;
	u8 operation;
	u8 operation_selected=0;
	u8 result=0;
	while(1)
	{
		u8 key,lastKey;
		key = KPD_Scan();
		lastKey = key;
		key = KPD_Scan();
		if(key != lastKey && key!=0)
		{
			lcd_display_1[curser]=key;
			key=0;
			curser++;
			update_screen=1;
		}
		if(update_screen)
		{
			LCD_Clear();
			LCD_void_SendString(lcd_display_1);
			LCD_GoTO(2,0);
			LCD_void_SendString(lcd_display_2);
			LCD_GoTO(1,curser);
			update_screen=0;
		}
		int i;
		u8 operation;
		u8 operation_selected;
		for(i=0;i<curser;i++)
		{
			if(lcd_display_1[i]>='0' && lcd_display_1[i]<='9')
			{
				if(first_number_flag==0)
				{
					first_number=lcd_display_1[i];
					first_number_flag=1;

				}
				else if(operation_selected==1)
				{
					second_number=lcd_display_1[i];
					second_number_flag=1;
				}

			}
			else
			{
				switch (lcd_display_1[i])
				{
					case'C':
					{
						first_number=0;
						operation=0;
						u8 j=0;
						for(j=0;j<curser;j++)
						{
							lcd_display_1[j]=0;
						}
						curser=0;
						LCD_Clear();
						LCD_GoTO(1,1);
						break;
					}
					case '=':
					{
						if(first_number_flag==1 && operation_selected ==1  && second_number_flag ==1)
						{
							switch (operation)
							{
								case 1:
								{
									result=first_number+second_number;

									break;
								}

								default:
									break;
							}
						}
						break;
					}
					case '+':
					{
						operation=1;
						first_number_flag=1;
						operation_selected=1;
						break;
					}

					default:
					{
						LCD_Clear();
						LCD_void_SendString(lcd_display_1);

						break;
					}

				}
			}
		}

	}
	return 0 ;
}






/*
ISR(1)
{

	LED1_On();
	_delay_ms(1000);
	LED1_Off();
}
*/



