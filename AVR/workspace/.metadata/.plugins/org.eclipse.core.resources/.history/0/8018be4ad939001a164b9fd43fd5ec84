/*
 * DIO_driver.c
 *
 *  Created on: 14 Jan 2020
 *      Author: Mohamed
 */
//#include "../../MCAL/INC/DIO_driver.h"
#include "../../UTILITIES/STD_TYPES.h"
#include "../../UTILITIES/BIT_MATH.h"
#include "DIO_driver.h"

extern DIO_config_t DIO_groups [DIO_Number_of_groups];

#define GRP_PORT(X) 	DIO_groups[X].port_id
#define GRP_MASK(X) 	DIO_groups[X].mask
#define GRP_DIR(X)	 	DIO_groups[X].direction
#define GRP_PULL(X) 	DIO_groups[X].pull_up_reg

void DIO_Init	(void)
{
	u8 i=0;
	for(i=0;i<DIO_Number_of_groups;i++)
	{

		DDR( GRP_PORT(i) )  &= ~ ( GRP_MASK(i) ) ;				/*ddr = reset(mask)*/

		DDR( GRP_PORT(i) ) 	|=  (GRP_DIR(i)  &  GRP_MASK(i));	/*ddr = set(dir & mask)*/

																/*port = reset(mask)*/
		PORT( GRP_PORT(i) )	&= ~( GRP_MASK(i) );
																/*port = set(pull up & mask & ~dir)*/
		PORT( GRP_PORT(i) )	 |=  ( GRP_PULL(i) 	&  GRP_MASK(i) & ( ~GRP_DIR(i) ) );
	}

}
void DIO_Write 	(u8 data, u8 Group_id)
{	u8 Copy_portValue 	= PORT( GRP_PORT(Group_id));

	Copy_portValue 		&= ~( GRP_MASK(Group_id) );
	Copy_portValue 		|=  (GRP_MASK(Group_id) & data );

	PORT( GRP_PORT(Group_id))	= Copy_portValue;
}


u8   DIO_Read	(u8 Group_id)
{
	/*RETURN PIN & MASK */
	return ( PIN(DIO_groups[Group_id].port_id)   &   DIO_groups[Group_id].mask ) ;
}

void DIO_Toggle 	(u8 data, u8 Group_id)
{	u8 Copy_portValue 	= PORT( GRP_PORT(Group_id));

	Copy_portValue 		&= ~( GRP_MASK(Group_id) );
	Copy_portValue 		^=  (GRP_MASK(Group_id) & data );

	PORT( GRP_PORT(Group_id))	= Copy_portValue;
}

